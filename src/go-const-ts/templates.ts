// data: null
// file: pipe/index-base.pipe.ts
export const indexBasePipeTpl = `// Generated by node-private-tools
import { Pipe, PipeTransform } from '@angular/core';
import { XlangJsonService } from 'ng-ef-sand/xlang';

export abstract class IndexBasePipe implements PipeTransform {
  private tr: string[] = [];
  private sub: any;

  constructor(private xlangJsonService: XlangJsonService, private xlangId: string) { }

  transform(index: number) {
    if (!this.sub) {
      this.sub = this.xlangJsonService.load(this.xlangId).subscribe(tr => this.tr = tr.json);
    }
    return this.tr[index] || '';
  }

  ngOnDestroy() {
    if (this.sub) {
      this.sub.unsubscribe();
    }
  }
}
`;

// data: ConstType: {type, pipe}
// file: pipe/{pipe}.pipe.ts
// xlangId: {pipe}
export const pipeTpl = `// Generated by node-private-tools
import { Pipe, PipeTransform } from '@angular/core';
import { XlangJsonService } from 'ng-ef-sand/xlang';
import { IndexBasePipe } from './index-base.pipe';

@Pipe({
  name: '{{{pipe}}}',
  pure: false,
})
export class {{{type}}}Pipe extends IndexBasePipe implements PipeTransform {
  constructor(xlangJsonService: XlangJsonService) {
    super(xlangJsonService, '{{{pipe}}}');
  }
}
`;

// data: ConstType[]: {type, pipe}[] as types
// file: pipe.ts
export const pipeIndexTpl = `// Generated by node-private-tools
import { NgModule } from '@angular/core';

{{#each types}}import { {{{type}}}Pipe } from './pipe/{{{pipe}}}.pipe';
{{/each}}

export {
{{#each types}}  {{{type}}}Pipe,
{{/each}}
}

export const GO_CONST_PIPES = [
{{#each types}}  {{{type}}}Pipe,
{{/each}}
];

@NgModule({
  declarations: [
    ...GO_CONST_PIPES,
  ]
})
export class GoConstsPipesRootModule { }
`;

// data: ConstType
// file: enum/{pipe}.enum.ts
// xlangId: pipe
export const enumTpl = `// Generated by node-private-tools
// tslint:disable:max-line-length
// tslint:disable:whitespace
export enum {{{type}}} {
  {{{names}}}
}
`;

// data: ConstType[] as types
// file: enum.ts
export const enumIndexTpl = `// Generated by node-private-tools
{{#each types}}export * from './enum/{{{pipe}}}.enum';
{{/each}}
`;

// names
// data: ConstType.names
// file: names/{pipe}.json

// xlangJson
// data: ConstType ConstTypeTrs
// file: xlang/{pipe}/{lang}.json

// errors
// data: Prettier.errors
// file: go-const-errors.log
